# 翻译@View Controller Programming Guide for iOS（iOS视图控制器编程指南）

- 原文：[View Controller Programming Guide for iOS](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/index.html#//apple_ref/doc/uid/TP40007457-CH2-SW1)
- 作者：[Apple](https://developer.apple.com/library/content/navigation/)
- 更新：[Yannmm@Github.com](https://github.com/Yannmm/Auto-Layout-Guide-Chinese-Translation)

---

## View Controller Definition（定义视图控制器）

### Defining Your Subclass（控制器子类）

app内容通过[UIViewController](https://developer.apple.com/documentation/uikit/uiviewcontroller)子类显示。大多数控制器子类都是内容控制器，即拥有视图，并负责组织视图数据。与此相对的是容器视图，其并不拥有自己的视图，而是管理其它控制器的视图。不论是内容控制器还是容器控制器，其创建的过程大体相同，我们稍后讨论。

常见的内容控制器父类有：

- 内容为表格，[UITableViewController](https://developer.apple.com/documentation/uikit/uitableviewcontroller)；
- 内容为集合视图，[UICollectionViewController](https://developer.apple.com/documentation/uikit/uicollectionviewcontroller)；
- 其它视图，[UIViewController](https://developer.apple.com/documentation/uikit/uiviewcontroller)；

对于容器视图来说，父类的选择取决于是基于现有容器控制器进行修改，还是重新创建。前者选择要修改的容器控制器作为父类即可，后者直接继承自[UIViewController](https://developer.apple.com/documentation/uikit/uiviewcontroller)。更多信息，详见[Implementing a Container View Controller](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/ImplementingaContainerViewController.html#//apple_ref/doc/uid/TP40007457-CH11-SW1)。

#### Defining Your UI（编写UI）

使用storyboard创作UI是最佳选择，相比于纯代码，其可以做到所见即所得，迅速适配不同显示环境，必须针对每次修改重新编译。

图4-1显示了一个storyboard。每个矩形对应一个视图控制器，箭头代表控制器之间的关系或专长。所谓关系，指容器控制器与子控制器之间的关系；segue表示控制器之间的转换。

**图4-1** storyboard包含多个控制器和视图

一般来说，每个新项目都有一个主要storyboard，其中已包含若干控制器。通过拖拽的方式可以从素材库添加新的控制器到storyboard中。新控制器默认是`UIViewController`，需要手动在身份面板中修改。

使用storyboard可以完成如下工作：

- 添加，调整，配置控制器视图；
- 链接outlets和动作，详见[Handling User Interactions](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/DefiningYourSubclass.html#//apple_ref/doc/uid/TP40007457-CH7-SW11)；
- 创建控制器之间关系和segue，详见[Using Segues](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/UsingSegues.html#//apple_ref/doc/uid/TP40007457-CH15-SW1)；
- 位不同size class调整布局和视图，详见[Building an Adaptive Interface](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/BuildinganAdaptiveInterface.html#//apple_ref/doc/uid/TP40007457-CH32-SW1)；
- 添加手势识别器，处理交互，详见`Event Handling Guide for iOS`。

对于尚未掌握stroyboard的同学来说，可以在`Start Developing iOS Apps Today`找到手把手教学。

#### Handling User Interactions（处理交互）

App事件的响应对象负责处理事件，作出相应动作。控制器虽然是相应对象，但其极少直接处理事件，而是：

- **定义动作方法处理高级事件**。[动作方法（action methods）](https://developer.apple.com/library/content/documentation/General/Conceptual/Devpedia-CocoaApp/TargetAction.html#//apple_ref/doc/uid/TP40009071-CH3)指的是：

	- 特定动作。控件和某些视图会针对特定交互触发动作方法；
	- 手势识别。手势识别器侦测特定手饰，触发动作方法，报告手势状态。控制器应该处理这些状态变化，响应手势的完成。

- **接受系统或其它对象发出的通知**。通知报告变化，是控制器更新状态的手段之一；
- **扮演其它对象的数据源或代理**。控制器家经常负责管理列表和集合视图的数据。此外，还可以作为诸如[CLLocationManager](https://developer.apple.com/documentation/corelocation/cllocationmanager)等对象的代理，其发送位置更新。

响应事件意味着更新视图内容，所以需要引用视图。控制器是为稍后需要修改的视图定义[outlets](https://developer.apple.com/library/content/documentation/General/Conceptual/Devpedia-CocoaApp/Outlet.html#//apple_ref/doc/uid/TP40009071-CH4)的好地方。使用代码4-1的语法，像声明属性一样声明outlet。例子中定义了两个outlet（通过关键字[IBOutlet](https://developer.apple.com/documentation/appkit/constants/interface_builder_constants/iboutlet)标记），以及一个动作方法（通过关键字[IBAction](https://developer.apple.com/documentation/appkit/constants/interface_builder_constants/ibaction)标记）。outlet保存了指向storyboard中按钮和文本栏的引用，而动作方法响应按钮点击。

**代码4-1** 定义outlet和动作方法

```
// OBJECTIVE-C
@interface MyViewController : UIViewController
@property (weak, nonatomic) IBOutlet UIButton *myButton;
@property (weak, nonatomic) IBOutlet UITextField *myTextField;
 
- (IBAction)myButtonAction:(id)sender;
 
@end

// SWIFT
class MyViewController: UIViewController {
    @IBOutlet weak var myButton : UIButton!
    @IBOutlet weak var myTextField : UITextField!
    
    @IBAction func myButtonAction(sender: id)
}

```

在storybaord中，记得将视图上的outlet和动作方法与控制器相连，这样可以确保视图被载入时链接自动建立。更多关于适用Interface Builder创建链接和动作的信息，详见`Interface Builder Connections Help`。更多关于处理事件的信息，详见`Event Handling Guide for iOS`。

#### 显示视图（Displaying Your Views at Runtime）

使用storyboard，加载和显示控制器的过程十分简单。系统按需自动从storyboard中读取视图。作为加载过程的一部分，系统将完成下述任务：

1. 使用storyboard中的信息初始化视图；
2. 链接outlet和动作方法；
3. 为控制器属性[view](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621460-view)赋值；
4. 调用控制器方法[awakeFromNib](https://developer.apple.com/documentation/objectivec/nsobject/1402907-awakefromnib)；
	
	这个方法调用时，控制器的显示特征仍为空，视图位置可能不是最终位置。
	
5. 调用控制器方法[viewDidLoad](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621495-viewdidload)。

	 使用这个方法添加或移除视图，修改约束，加载数据。
	 
显示控制器视图之前，仍有机会在显示前后调整视图。系统将依次调用下述方法：

1. 控制器方法[viewWillAppear:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621510-viewwillappear)，表示视图即将显示；
2. 更新视图布局；
3. 显示在屏幕上；
4. 控制器方法[viewDidAppear:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621423-viewdidappear)，表示视图已经显示在屏幕上。

无论是添加，移除，还是修改视图的位置或尺寸，记得添加或移除相应的约束。修改约束，系统会将布局标记为需要重新计算。下次更新循环时，布局引擎会使用新的约束计算视图的尺寸和位置，调整视图结构。

更多信息，详见[UIViewController Class Reference](https://developer.apple.com/documentation/uikit/uiviewcontroller)。

#### 管理视图布局（Managing View Layout）

记号
	 
