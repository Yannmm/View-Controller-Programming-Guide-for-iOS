# 翻译@View Controller Programming Guide for iOS（iOS视图控制器编程指南）

- 原文：[View Controller Programming Guide for iOS](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/index.html#//apple_ref/doc/uid/TP40007457-CH2-SW1)
- 作者：[Apple](https://developer.apple.com/library/content/navigation/)
- 更新：[Yannmm@Github.com](https://github.com/Yannmm/Auto-Layout-Guide-Chinese-Translation)

---

## Presentations and Transitions（呈现和转场）

### Presenting a View Controller（ 呈现控制器）

视图控制器借助两种方式展示在屏幕上：容器控制器或直接呈现。前者是App层级结构的基础；后者提供额外的引导作用。被呈现的控制器位于当前控制器上方。典型的应用场景是创造一个焦点界面（Modal Interface），不过也可以有其他用途 。（译者：不理解Modal含义的同学，可以参考wikipedia上关于[Modal Window](https://en.wikipedia.org/wiki/Modal_window)的定义）

[UIViewController](https://developer.apple.com/documentation/uikit/uiviewcontroller)及其子类天生支持同呈现相关的所有功能。任意控制器都可以呈现其他控制器，虽然最终请求可能会指向同一个控制器。此时，两个控制器之间是呈现（presenting）与被呈现（presented）的关系，是整个视图结构体系的一部分。这种关系将一直保持，直至取消呈现（dismiss）。

#### The Presentation and Transition Process（呈现和转场过程）

伴随着转场动画，控制器内容最终以某种形式呈现在屏幕上。无论是呈现形式，还是转场动画，UIKit都允许我们自定义。如果使用系统的默认配置，则整个呈现过程只需极少的代码即可实现；如果自定义，则可以配合任意控制器使用。

呈现可以通过SB segue（引导）或代码发起。App层级结构较为固定时，segue是最简单的方式。而对于动态变化的界面，亦或是没有控件可供触发segue时，则需要通过[UIViewController](https://developer.apple.com/documentation/uikit/uiviewcontroller)相关方法进行。

##### Presentation Styles（呈现形式）

控制器的呈现形式决定其在屏幕上的显示效果。UIKit预先定义了一组呈现形式，显示效果和用意各不相同。当然，系统允许我们自定义。设计App时，选择与需求最相符的呈现形式，并为控制器属性[modalPresentationStyle](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621355-modalpresentationstyle)赋值。

###### Full-Screen Presentation Styles（全屏）

顾名思义，全屏呈现时，控制器内容覆盖整个屏幕，用户不能再与下层内容交互。正常宽度下（horizontally regular），只有一个全屏选项能够覆盖整个屏幕。剩下的都使用暗色或透明遮罩覆盖下层内容。紧凑宽度下（horizontally compact），所有的全屏选项的效果都与`UIModalPresentationFullScreen`一致，完全遮挡下层内容。

图8-1分别展示了[UIModalPresentationFullScreen](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/uimodalpresentationfullscreen)，[UIModalPresentationPageSheet](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/uimodalpresentationpagesheet)和[UIModalPresentationFormSheet](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/1621491-formsheet)在正常宽度下的效果：左上方绿色控制器使用不同形式呈现右上方蓝色控制器。注意，`UIModalPresentationPageSheet`和`UIModalPresentationFormSheet`利用遮罩分隔上下层内容。

**图8-1** 全屏呈现

![图8-1]()

>注意
>
>使用`UIModalPresentationFullScreen`呈现时，UIKit在转场动画结束后移除下层内容。要保留下层内容，则可以使用[UIModalPresentationOverFullScreen](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/1621506-overfullscreen)。如果上层内容包含透明区域，可以显示下层内容时，可以使用这个选项。

全屏呈现时，呈现控制器（presenting）必须覆盖整个屏幕。否则，UIKit将沿着控制器结构寻找第一个符合要求的控制器。如果无法找到，则使用视窗的根控制器。

###### The Popover Style（弹窗）

[UIModalPresentationPopover](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/uimodalpresentationpopover)在弹窗中显示被呈现控制器内容。弹窗一般用来表示同当前目标对象有关的额外信息和选项。正常宽度下，弹窗只覆盖部分屏幕，如图8-2所示。点击弹窗以外区域，弹窗自动收起；紧凑宽度下，呈现形式默认切换为[UIModalPresentationOverFullScreen](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/1621506-overfullscreen)。

**图8-2** 弹窗呈现

![图8-2]()

由于紧凑宽度下弹窗自动切换为全屏，所以需要适配这种变化。全屏时，为了方便用户返回，可以在界面上添加取消按钮，使用容器控制器，或修改呈现形式。

具体关于弹窗呈现的使用，详见章节[Presenting a View Controller in a Popover（在弹窗中呈现控制器）](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/PresentingaViewController.html#//apple_ref/doc/uid/TP40007457-CH14-SW13)。

###### The Current Context Styles（当前环境）  xxx翻译不通

[UIModalPresentationCurrentContext](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/1621493-currentcontext)覆盖当前界面上特定控制器的内容。使用这一样式时，需要将被覆盖控制器的属性[definesPresentationContext](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621456-definespresentationcontext)设置为YES。如图8-3所示，分屏控制器（split view controller）的其中一个子控制器被覆盖。

**图8-3** 当前环境

>注意
>
>使用`UIModalPresentationFullScreen`呈现时，UIKit在转场动画结束后移除下层内容。要保留下层内容，则可以使用[UIModalPresentationOverCurrentContext](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/uimodalpresentationovercurrentcontext)。如果上层内容包含透明区域，可以显示下层内容时，可以使用这个选项。

除了呈现上下文之外，转场动画效果也可以修改。通常，UIKit根据被呈现控制器属性[modalTransitionStyle](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621388-modaltransitionstyle)。如果呈现情景控制器属性[providesPresentationContextTransitionStyle](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621356-providespresentationcontexttrans)为YES，则使用其属性`modalTransitionStyle`中的值。

显示环境变化为紧凑宽度时，呈现形式则自动切换为[UIModalPresentationFullScreen](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/uimodalpresentationfullscreen)。为了适应这种变化，需要在自适应呈现代理处作出具体改变。

###### Custom Presentation Styles（自定义形式） 

[UIModalPresentationCustom](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/uimodalpresentationcustom)允许我们使用自定义样式呈现控制器，涉及到创建[UIPresentationController](https://developer.apple.com/documentation/uikit/uipresentationcontroller)子类，添加动画，以及设置被呈现控制器内容的最终位置。此外，还需要处理被呈现控制器在显示环境改变时进行适应。

更多关于如何进行自定义呈现的内容，详见章节[Creating Custom Presentations](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/DefiningCustomPresentations.html#//apple_ref/doc/uid/TP40007457-CH25-SW1)。


##### Transition Styles（转场效果） 

转场效果就是被呈现控制器内容显示在屏幕上时所伴随的动画。UIKit定义了一组预设动画，通过设置给被呈现控制器属性[modalTransitionStyle](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621388-modaltransitionstyle)，即可使用。呈现时，系统会自动实现相应动画。图8-4展示了标准的上滑效果（[UIModalTransitionStyleCoverVertical](https://developer.apple.com/documentation/uikit/uimodaltransitionstyle/1621455-coververtical)）。控制器B从屏幕下方，向上升起，直至覆盖当前控制器A。移除控制器B时，效果正好相反：B向下滑动，完全露出A。

**图8-4** 转场效果

![图8-4]()

自定义转场需要通过动画对象和转场代理共同实现。动画对象负责负责创建动画；转场对象提供负责在合适的时机操作动画对象。更多关于实现自定义转场的信息，详见[Customizing the Transition Animations](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/CustomizingtheTransitionAnimations.html#//apple_ref/doc/uid/TP40007457-CH16-SW1)。

##### Presenting Versus Showing a View Controller（Presenting vs Showing）

一个控制器显示另一个，有两种方法：

- 方法[showViewController:sender:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621377-show)以及[showDetailViewController:sender:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621432-showdetailviewcontroller)最为灵活，适应性强。这些方法允许呈现控制器自省处理呈现。例如，容器控制器通常会选择将目标控制器作为自控制器纳入视图结构，而非焦点呈现。默认，焦点呈现。
- [presentViewController:animated:completion:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621380-presentviewcontroller)总是焦点呈现。这个方法的调用方有可能不是最中负责呈现的，但总是焦点呈现。这个方法会自动适应紧凑宽度。


方法`showViewController:sender:`以及`showDetailViewController:sender:`是进行呈现的最佳选择。其好处在于无需了解控制器结构以及调用方在视图结构中的位置。此外，还有利于控制器复用。

#### Presenting a View Controller（呈现控制器）

有三种方式发起呈现：

- segue。只需在IB中设置相应信息即可，其会自动触发。更多关于配置segue的信息，详见[Using Segues](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/UsingSegues.html#//apple_ref/doc/uid/TP40007457-CH15-SW1)；
- 方法[showViewController:sender:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621377-show)以及[showDetailViewController:sender:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621432-showdetailviewcontroller)。自定义控制器时，可以进一步修改这些方法的实现；
- 方法[presentViewController:animated:completion:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621380-presentviewcontroller)。直接焦点呈现。

关于移除呈现中的控制器的信息，详见[Dismissing a Presented View Controller](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/PresentingaViewController.html#//apple_ref/doc/uid/TP40007457-CH14-SW10)。


#### Showing View Controllers（展示）

- 方法[showViewController:sender:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621377-show)以及[showDetailViewController:sender:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621432-showdetailviewcontroller)显示控制器时，整个过程简单明了：

	1. [创建](https://developer.apple.com/library/content/documentation/General/Conceptual/DevPedia-CocoaCore/ObjectCreation.html#//apple_ref/doc/uid/TP40008195-CH39)要呈现的控制器，填充所需数据；
	2. 设置控制器属性[modalPresentationStyle](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621355-modalpresentationstyle)，选择合适的呈现效果。注意，这个样式可能不是最后使用的样式；
	3. 设置控制器属性[modalTransitionStyle](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621388-modaltransitionstyle)，选择最合适的过场效果。注意，这可能并非最终效果。
	4. 使用方法[showViewController:sender:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621377-show)或[showDetailViewController:sender:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621432-showdetailviewcontroller)，展示控制器。


实际上，UIKit会将上述方法的调用转发给合适的控制器，再由其决定如何处理呈现，并有机会修改呈现和动画效果。例如，导航控制器会将目标控制器推入栈中。

关于展示和呈现控制器的区别，详见[Presenting Versus Showing a View Controller](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/PresentingaViewController.html#//apple_ref/doc/uid/TP40007457-CH14-SW4)。

#### Presenting View Controllers Modally（焦点呈现）

直接呈现控制器时，需要向UIKit指明其呈现和过场效果。

1. [创建](https://developer.apple.com/library/content/documentation/General/Conceptual/DevPedia-CocoaCore/ObjectCreation.html#//apple_ref/doc/uid/TP40008195-CH39)要呈现的控制器，填充所需数据；
2. 设置控制器属性[modalPresentationStyle](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621355-modalpresentationstyle)，选择合适的呈现效果；
3. 设置控制器属性[modalTransitionStyle](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621388-modaltransitionstyle)，选择最合适的过场效果；
4. 调用当前控制器方法[presentViewController:animated:completion:](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621380-presentviewcontroller)。

方法`presentViewController:animated:completion:`的接收者可能不是最终负责呈现的控制器。呈现效果决定被呈现控制器的展示效果，以及对呈现控制器的要求。例如，全屏呈现效果必须由一个全屏控制器发起。如果当前控制器不满足条件，UIKit将沿着控制器结构寻找，直到找到合适的。焦点呈现完成之际，相关控制器的属性[presentingViewController](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621430-presentingviewcontroller)和[presentedViewController](https://developer.apple.com/documentation/uikit/uiviewcontroller/1621407-presentedviewcontroller)得到更新。

记号