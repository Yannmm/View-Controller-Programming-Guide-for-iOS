# 翻译@View Controller Programming Guide for iOS（iOS视图控制器编程指南）

- 原文：[View Controller Programming Guide for iOS](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/index.html#//apple_ref/doc/uid/TP40007457-CH2-SW1)
- 作者：[Apple](https://developer.apple.com/library/content/navigation/)
- 更新：[Yannmm@Github.com](https://github.com/Yannmm/Auto-Layout-Guide-Chinese-Translation)

---


## Adaptivity and Size Changes（自适应界面与尺寸类别）

### The Adaptive Model（ 自适应模型）

自适应界面能够最大化屏幕利用率，根据设备调整内容，动态调整缩放布局。据此，只需少量代码，一套界面可以适配各种尺寸屏幕（如图12-1所示）。

**图12-1** 适配不同屏幕尺寸和设备方向

![图12-1]()

auto layout是创建自适应界面的重要工具：利用interface builder或代码定义规则（约束），视图根据规则布局。父视图尺寸改变，子视图布局随之改变。

traits（显示环境特征）是自适应界面的另一个重要组成部分，是对显示环境的描述，帮助我们确定布局的大方向。


#### The Role of Traits（ 理解显示环境特征）

单纯使用约束无法满足需求时，视图控制器可以根据traits调整布局。控制器，视图等界面对象通过traits了解自身显示环境。表12-1是各种特征的解释。

**表12-1** traits包含的信息

特征  | 示例 | 描述
------------- | ------------- | -------------
[horizontalSizeClass](https://developer.apple.com/documentation/uikit/uitraitcollection/1623508-horizontalsizeclass)  | [UIUserInterfaceSizeClassCompact](https://developer.apple.com/documentation/uikit/uiuserinterfacesizeclass/1623403-compact) | （显示环境的）总体宽度。可以作为横向布局的总体参考，如视图横向或竖向排列，隐藏，或以其他形式显示。
[verticalSizeClass](https://developer.apple.com/documentation/uikit/uitraitcollection/1623513-verticalsizeclass)  | [UIUserInterfaceSizeClassRegular](https://developer.apple.com/documentation/uikit/uiuserinterfacesizeclass/uiuserinterfacesizeclassregular) | 总体高度。可以作为纵向布局的总体参考，例如设计要求所有内容必须同时位于屏幕内，且不能滚动，就要参考这个特征。
[displayScale](https://developer.apple.com/documentation/uikit/uitraitcollection/1623519-displayscale)  | 2.0 | 屏幕分辨率种类（标准或retina）。这个特征可以作为像素级别的布局的参考，如图片素材的选择。
[userInterfaceIdiom](https://developer.apple.com/documentation/uikit/uitraitcollection/1623521-userinterfaceidiom)  | [UIUserInterfaceIdiomPhone](https://developer.apple.com/documentation/uikit/uiuserinterfaceidiom/uiuserinterfaceidiomphone) | 设备种类。这是一个用于向下兼容的特征，尽量不要使用，size class已经取而代之。

traits是非常重要的信息：interface builder支持据此调整视图，图片以及约束；许多UIKit控件，如[UIImageAsset](https://developer.apple.com/documentation/uikit/uiimageasset)能够根据traits配置。

下列建议能够帮助我们正确使用traits：

- **size class决定粗粒度布局**。每当size class改变，添加或删除视图，控制器和约束。如果不做改变，界面以约束为准自动适应size class变化。
- **size class与具体尺寸没有对应关系**。控制器的size class可能出于多种原因改变。例如，iPhone上的容器控制器可以指定其子控制器水平宽度为正常，让其以另一种方式显示。
- **interface builder支持根据size class配置约束**。这要比编写添加/删除约束代码简单的多。届时，视图控制器将自动根据size class变化调整约束。更多关于根据size class配置约束的信息，详见[Configuring Your Storyboard to Handle Different Size Classes](https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/BuildinganAdaptiveInterface.html#//apple_ref/doc/uid/TP40007457-CH32-SW2)。
- **避免使用idiom**。理论上讲，不论是iPad还是iPhone，app应始终显示同一套内容，所以根据size class布局即可。

#### When Do Trait and Size Changes Happen?（ 显示环境特征的变化时机）

视图控制器的traits随着显示环境的变化而变化。traits不会频繁改变，不同特征的变化频率不尽相同。size class比scale变化的频繁的多；idiom极少改变。size class可能基于如下原因改变：

记号

- 控制器视图所在的window的水平或垂直size class改变，通常是因为设备发生了旋转；
- 容器控制器的size class发生改变；
- 当前控制器的size class被其容器控制器主动改变。

控制器结构会将size class的改变传递给所有子控制器。视窗对象是视图结构的根部，为根控制器提供最基础的traits。设备方向和水平和垂直之间切换时，视窗更新自己的size class，并将这些信息床传递给控制器结构。容器控制器可以将这些改变原封不动的传递给子控制器，也可以先修改，再传递。

iOS8后，视窗的原点总是左上角，其bounds会在设备发生旋转时变化。视窗的size变化会扩散给视图控制器结构，其中还包括其他taits变化。对于每个控制器，UIKit通过下述方法告知其变化：

- 方法[willTransitionToTraitCollection:withTransitionCoordinator:](https://developer.apple.com/documentation/uikit/uicontentcontainer/1621511-willtransition)意味着traits即将改变；
- 方法[viewWillTransitionToSize:withTransitionCoordinator:](https://developer.apple.com/documentation/uikit/uicontentcontainer/1621466-viewwilltransition)意味着size即将改变；
- 方法[traitCollectionDidChange:](https://developer.apple.com/documentation/uikit/uitraitenvironment/1623516-traitcollectiondidchange)意味着traits已经改变；

遍历控制器结构时，UIKit只有在发生改变时才会通知控制器。如果容器控制器重写了子控制器的size class，则容器控制器size class改变时，UIKit不会通知子控制器。类似的，如果控制器根视图的尺寸固定，则它不会收到size变化通知。

图12-2显示了iPhone 6旋转时上控制器的traits和视图size发生变化时的情况。从垂直旋转到水平防线，垂直防线的size class从正常变为紧凑。size class的变化和相应视图size的变化随后下发到视图控制器结构。视图逐渐过渡为新size后，UIkit使用新的traits和size，随后调用方法`traitCollectionDidChange:`。

**图12-2** 更新视图控制器的traits和视图size

![图12-2]()

#### Default Size Classes for Different Devices（设备的默认size class）

每个iOS设备都有一组默认size class，可以作为其显示环境的描述。表12-2罗列了个设备横竖向的size class。未列出的设备与显同屏幕尺寸的设备的size class相同。

**表12-2** 不同屏幕尺寸的size class

设备 | 竖向 | 横向
------------- | ------------- | -------------
所有iPad <br> iPad Mini | 垂直：正常 <br> 水平：正常 | 垂直：正常 <br> 水平：正常
iPhone 6 Plus | 垂直：正常 <br> 水平：紧凑 | 垂直：紧凑 <br> 水平：正常
iPhone 6 | 垂直：正常 <br> 水平：紧凑 | 垂直：紧凑 <br> 水平：紧凑
iPhone 5s <br> iPhone 5c <br> iPhone 5 | 垂直：正常 <br> 水平：紧凑 | 垂直：紧凑 <br> 水平：紧凑
iPhone 4s | 垂直：正常 <br> 水平：紧凑 | 垂直：紧凑 <br> 水平：紧凑

>重要：不要假设app一定运行在某种设备上，根据size clas做决定。
